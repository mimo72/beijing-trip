# 北京旅行攻略 v2 - 技术执行方案

> 项目：2人北京春节旅行（2026/2/20-2/24，大年初四至初八）
> 版本：v2
> 日期：2026-02-12
> 角色：技术架构师

---

## 0. v1 复盘与 v2 设计原则

### v1 核心失败点

| 失败点 | 根因 | v2 对策 |
|--------|------|---------|
| 航班时刻错误（偏差3小时） | 无网络验证，Agent 凭训练数据猜测 | 用户已提供已验证数据，标记为"锚定事实" |
| 7个Agent全部写入失败 | 未预先确认文件写入权限 | 本方案先行确认所有权限 |
| 信息以事实口吻输出但未验证 | 无分级标注机制 | 引入三级可信度标注体系 |
| 7份文件间存在潜在矛盾 | 无整合校验层 | 增加 QA 整合 Agent 做交叉校验 |

### v2 设计原则

1. **事实分级**：所有输出信息标注可信度等级
   - `[已验证]` — 来自官方来源或用户确认的数据
   - `[高置信]` — 来自稳定规则/历史规律，大概率准确
   - `[需确认]` — 可能因春节/政策变动而不准确，附验证方式
2. **先验证后规划**：验证 Agent 必须先于规划 Agent 执行
3. **显式依赖**：Agent 之间通过明确的输入/输出接口连接
4. **Fallback 兜底**：每个关键数据项都有获取不到时的备选方案

---

## 1. 需要实时验证的数据清单

### 1.1 航班与机场（已完成验证）

| 数据项 | 重要性 | 验证来源 | 验证方式 | Fallback |
|--------|--------|---------|---------|----------|
| MU5105 航班时刻（10:00-12:15） | **锚定** | 用户已验证 | 已完成 | N/A |
| MU5128 航班时刻（21:00-23:10） | **锚定** | 用户已验证 | 已完成 | N/A |
| 虹桥T2官方停车场（P6/P7）费用 | 高 | https://www.shanghaiairport.com 或 "上海机场"微信公众号 | WebFetch 抓取停车服务页面 | 按历史价格估算：10元/小时，封顶80元/天，5天约400元；标注`[需确认]` |
| 虹桥T2停车场春节是否满位/限流 | 中 | 携程社区、小红书搜索"春节虹桥停车" | WebSearch | 建议出发前通过"上海机场"公众号实时查看车位；备选方案：周边民营停车场+接驳 |
| 首都T2到十里河亚朵的交通方式 | 高 | 百度地图/高德地图 | WebFetch 查询路线 | 基于已知地铁线路规划：机场大巴/地铁方案均列出 |

### 1.2 景点预约规则（核心验证项）

| 数据项 | 重要性 | 验证来源 | 验证方式 | Fallback |
|--------|--------|---------|---------|----------|
| 故宫预约规则与放票时间 | **关键** | https://www.dpm.org.cn（故宫博物院官网） | WebFetch 抓取"参观须知"/"网上预约"页面 | 历史规则：提前7天上午12:00放票，每日限流8万人，周一闭馆（法定节假日除外）；春节期间可能调整为提前10天放票；标注`[需确认]` |
| 故宫春节期间是否闭馆/调整开放时间 | **关键** | https://www.dpm.org.cn 公告栏 | WebFetch | 历史规律：春节假期正常开放（周一不闭馆），但需关注官方公告 |
| 故宫门票价格 | 中 | 同上 | WebFetch | 旺季60元/人，淡季（11.1-3.31）40元/人；2月属淡季 |
| 国家博物馆预约规则 | **关键** | https://www.chnmuseum.cn | WebFetch 抓取参观预约页面 | 历史规则：免费预约，提前7天放票，每日限流，需身份证实名；可通过"国家博物馆"微信公众号预约 |
| 国博春节开放安排 | 高 | 同上，公告栏 | WebFetch | 历史规律：春节期间正常开放，初一可能调整；周一闭馆 |
| 长城（八达岭）预约规则 | **关键** | https://www.badaling.cn 或 https://www.mutianyugreatwall.com（慕田峪） | WebFetch | 提前7天预约，全价40元/人（淡季35元/人）；春节期间正常开放；标注`[需确认]` |
| 长城春节期间交通方式 | 高 | 北京公交集团官网、877路/S2线信息 | WebSearch "春节八达岭 877路 运营" | 877路春节可能停运；S2线需查看；备选：包车/拼车（约400-600元） |
| 天安门广场开放时间 | 中 | https://www.tiananmen.org.cn 或 WebSearch | WebFetch | 全天开放（安检后进入），升旗时间可通过WebSearch查日出时间推算；2月下旬约6:50-7:10 |
| 天安门城楼是否开放 | 中 | 同上 | WebFetch | 历史上间歇性开放，门票15元；标注`[需确认]` |

### 1.3 酒店与住宿

| 数据项 | 重要性 | 验证来源 | 验证方式 | Fallback |
|--------|--------|---------|---------|----------|
| 朝阳十里河亚朵具体地址 | 高 | 亚朵官网 https://www.yaduo.com 或地图搜索 | WebFetch/WebSearch | 搜索"亚朵酒店 十里河"确认具体门店名称和地址 |
| 春节期间房价 | 中 | 携程/美团/亚朵官网 | WebSearch | 日常价约400-600元/晚；春节可能上浮；建议用户自行在APP确认 |
| 十里河地铁站信息 | 高 | 北京地铁官网 https://www.bjsubway.com | WebFetch | 十里河站：10号线、14号线交汇；标注`[高置信]` |

### 1.4 交通

| 数据项 | 重要性 | 验证来源 | 验证方式 | Fallback |
|--------|--------|---------|---------|----------|
| 北京地铁票价规则 | 中 | https://www.bjsubway.com | WebFetch 票价页面 | 起步价3元（6公里内），最高10元+；使用亿通行APP扫码乘车 |
| 十里河→故宫（天安门东）地铁路线 | 高 | 百度地图/高德地图 API 或地铁官网 | WebFetch | 10号线→1号线/2号线，约40分钟，费用约4-5元；标注`[高置信]` |
| 十里河→国博地铁路线 | 高 | 同上 | WebFetch | 10号线→1号线（天安门东/前门站），约35分钟 |
| 十里河→八达岭长城交通 | 高 | WebSearch "十里河到八达岭长城 交通" | WebSearch | 方案A：地铁→德胜门877路（约3小时）；方案B：地铁→黄土店S2线（约2.5小时）；方案C：包车 |
| 首都机场→十里河亚朵 | 高 | 百度地图 | WebFetch | 方案A：机场快轨→东直门→10号线→十里河（约1.5小时）；方案B：打车约100元/40分钟 |
| 北京一卡通/亿通行使用方式 | 低 | WebSearch | WebSearch | 推荐亿通行APP扫码乘地铁，微信/支付宝均可 |

### 1.5 春节特殊信息

| 数据项 | 重要性 | 验证来源 | 验证方式 | Fallback |
|--------|--------|---------|---------|----------|
| 2026北京春节庙会信息 | 高 | WebSearch "2026 北京春节庙会" | WebSearch | 历史参考：地坛庙会（最知名）、龙潭庙会、厂甸庙会等；通常初一至初五/初七；2026年是否举办需确认；标注`[需确认]` |
| 北京2/20-2/24天气预报 | 中 | https://www.weather.com.cn 或 WebSearch | WebFetch | 2月下旬北京历史均温：-3~6C，干燥，偶有大风；建议羽绒服+保暖内衣；临行前3天再查 |
| 春节期间餐厅营业状态 | 高 | 大众点评/美团（无法直接抓取） | WebSearch "北京春节 餐厅 营业" | 大型连锁/酒店餐厅基本正常营业；小型个体户可能歇业至初五/初七后；标注`[需确认]`，建议提前电话确认 |
| 春节期间打车难度 | 中 | WebSearch "北京春节 打车" | WebSearch | 历史经验：初一至初三最难打车，初四起逐步恢复；建议预约用车；滴滴/高德打车可用 |

### 1.6 美食与购物

| 数据项 | 重要性 | 验证来源 | 验证方式 | Fallback |
|--------|--------|---------|---------|----------|
| 十里河周边餐厅推荐 | 高 | WebSearch "十里河 美食推荐 2025/2026" | WebSearch | 基于已知商圈推荐：十里河周边有多个商场（华润/居然之家商圈），列出经典品类 |
| 故宫/前门周边餐厅 | 高 | WebSearch "前门大街 餐厅推荐" | WebSearch | 前门大街：全聚德（总店）、都一处烧麦、便宜坊等老字号；标注`[高置信]` |
| 北京伴手礼推荐（含购买地点） | 中 | WebSearch "北京特产 伴手礼 推荐" | WebSearch | 稻香村糕点、同仁堂养生品、瑞蚨祥丝绸、故宫文创等；标注`[高置信]` |
| 各餐厅春节是否营业 | 高 | 大众点评/电话确认 | WebSearch 辅助 | 老字号春节通常营业（全聚德、东来顺等），但需提前订位；标注`[需确认]` |

---

## 2. 所需权限清单

### 2.1 工具权限矩阵

| 权限 | 对应工具 | 用途 | 必要性 | 说明 |
|------|---------|------|--------|------|
| 网页抓取 | WebFetch | 访问官方网站验证景点预约规则、交通信息、停车费用等 | **必须** | 当前环境已具备 |
| 文件写入 | Write | 写入各攻略文件到 `/Users/tingyoo/beijing-trip/v2/` | **必须** | 当前环境已具备 |
| 文件读取 | Read | 读取 v1 已有文件作为参考/对比 | **必须** | 当前环境已具备 |
| 目录操作 | Bash | 创建子目录、列目录等 | **需要** | 当前环境需确认权限 |
| 文件搜索 | Glob/Grep | 搜索已有文件内容 | 辅助 | 当前环境已具备 |

### 2.2 权限缺口分析

| 理想权限 | 当前状态 | 影响 | 应对方案 |
|----------|---------|------|---------|
| WebSearch（搜索引擎） | **不具备**（无搜索引擎工具） | 无法搜索最新春节信息（庙会、餐厅营业等） | 用 WebFetch 访问特定已知URL；将不可验证项标注`[需确认]`并提供自助验证指引 |
| Bash | **需测试** | 无法创建子目录 | 用 Write 工具直接写入文件（Write 可自动创建父目录） |
| 大众点评/美团 API | **不具备** | 无法获取实时餐厅评分、营业状态 | 提供餐厅名称和推荐理由，标注`[需确认]`，建议用户在APP内自行查看 |
| 12306/航旅纵横 | **不具备** | 无法实时查询航班动态 | 航班数据已由用户验证锚定，无需再查 |

### 2.3 本次执行可用工具确认

- **WebFetch**: 可用 -- 可访问公开网页
- **Write**: 可用 -- 可创建/写入文件
- **Read**: 可用 -- 可读取已有文件
- **Glob/Grep**: 可用 -- 可搜索文件
- **Bash**: 可用 -- 由主 Agent 代为执行

---

## 3. Agent 执行方案

### 3.1 Agent 总览

共设计 **6 个执行 Agent + 1 个 QA 整合 Agent**：

| Agent ID | 名称 | 职责 | 依赖 |
|----------|------|------|------|
| A0 | **数据验证 Agent** | 通过 WebFetch 验证所有关键数据项 | 无（首先执行） |
| A1 | **行程规划 Agent** | 制定5天4晚详细日程 | 依赖 A0 |
| A2 | **交通攻略 Agent** | 所有交通方案（机场往返+每日出行） | 依赖 A0、A1 |
| A3 | **美食攻略 Agent** | 每日餐饮推荐（含春节营业评估） | 依赖 A1（需知道每天在哪个片区） |
| A4 | **装备清单 Agent** | 穿衣/装备/必带物品清单 | 依赖 A0（需天气数据） |
| A5 | **伴手礼 Agent** | 伴手礼推荐+购买地点规划 | 依赖 A1（需知道哪天有空购物） |
| QA | **QA 整合 Agent** | 交叉校验+矛盾检测+生成总览 | 依赖 A1-A5 全部完成 |

### 3.2 依赖关系图

```
                    ┌─────────────┐
                    │ A0 数据验证  │
                    │  (首先执行)  │
                    └──────┬──────┘
                           │
              ┌────────────┼────────────┐
              │            │            │
              v            v            v
        ┌───────────┐ ┌────────┐ ┌───────────┐
        │ A1 行程规划│ │A4 装备 │ │(部分A3可  │
        │           │ │  清单  │ │ 并行准备) │
        └─────┬─────┘ └────────┘ └───────────┘
              │
    ┌─────────┼─────────┬────────────┐
    │         │         │            │
    v         v         v            v
┌──────┐ ┌──────┐ ┌──────────┐ ┌──────┐
│A2交通│ │A3美食│ │ A5伴手礼 │ │ ...  │
└──┬───┘ └──┬───┘ └────┬─────┘ └──────┘
   │        │          │
   └────────┼──────────┘
            v
     ┌─────────────┐
     │  QA 整合     │
     │  Agent       │
     └─────────────┘
```

**并行说明**：
- **第一阶段**（串行）：A0 数据验证 -- 必须先完成
- **第二阶段**（部分并行）：A1 行程规划 + A4 装备清单可并行（A4 仅依赖天气数据，不依赖行程）
- **第三阶段**（并行）：A2 交通 + A3 美食 + A5 伴手礼 -- 均依赖 A1 完成后并行执行
- **第四阶段**（串行）：QA 整合 -- 必须等所有 Agent 完成

### 3.3 各 Agent 详细规格

#### A0 - 数据验证 Agent

```
输入：
  - 第1节中的验证数据清单
  - 用户提供的锚定数据（航班时刻、酒店选择）

执行步骤：
  1. WebFetch 故宫官网 → 提取预约规则、放票时间、春节公告
  2. WebFetch 国博官网 → 提取预约规则、春节开放安排
  3. WebFetch 八达岭官网 → 提取预约规则、春节交通
  4. WebFetch 上海机场官网 → 提取停车场费用
  5. WebFetch 北京地铁官网 → 提取线路图、票价
  6. WebFetch 天气网站 → 获取2月下旬北京天气
  7. 汇总所有验证结果，对比Fallback预设值

输出：
  → 文件：02-verified-data.md
  → 内容：每个数据项的验证结果 + 可信度标签
  → 格式示例：
    - 故宫预约：提前7天放票 [已验证/官网2026.2公告]
    - 庙会信息：未查到2026年公告 [需确认]
```

#### A1 - 行程规划 Agent

```
输入：
  - 02-verified-data.md（A0 输出）
  - 锚定约束条件：
    · 2/20 12:15 落地首都T2 → 下午可用
    · 2/24 21:00 起飞首都T2 → 白天可用，17:00前到机场
    · 必去：天安门、故宫、国博、长城
    · 酒店：十里河亚朵
    · 节奏：不紧凑，留出拍照和休息时间
    · 2人出行

执行步骤：
  1. 根据景点开放限制确定哪天去哪里
  2. 故宫+天安门安排同一天（相邻）
  3. 长城安排独立一整天（往返耗时长）
  4. 国博安排半天~一天
  5. 剩余时间安排弹性景点（庙会/南锣鼓巷/什刹海/798等）
  6. 每天预留午餐和晚餐窗口
  7. 标注每个景点的预约截止日期和操作步骤

输出：
  → 文件：03-itinerary.md
  → 内容：5天4晚日程表
  → 格式：按天展开，每个时间段包含：
    · 时间
    · 活动
    · 地点
    · 预约状态/操作指引
    · 拍照Tips
    · [可信度标签]
```

#### A2 - 交通攻略 Agent

```
输入：
  - 03-itinerary.md（A1 输出）
  - 02-verified-data.md（A0 输出）

执行步骤：
  1. 为行程中每一段出行规划具体交通方案
  2. 自驾→虹桥段：停车场选择+费用
  3. 首都T2→十里河亚朵：至少2个方案（地铁/打车）
  4. 每日酒店→景点：地铁路线+备选打车
  5. 长城专项交通（最复杂）：公交/火车/包车对比
  6. 回程：酒店→首都T2

输出：
  → 文件：04-transport.md
  → 内容：
    · 自驾+停车方案
    · 每日交通详细路线
    · 地铁乘坐指南（APP、票价）
    · 长城交通专项方案
    · 费用汇总
```

#### A3 - 美食攻略 Agent

```
输入：
  - 03-itinerary.md（A1 输出，确定每天所在区域）
  - 02-verified-data.md（春节营业信息）

执行步骤：
  1. 按行程中每天所在的区域推荐餐厅
  2. 涵盖：北京烤鸭、老北京铜锅涮肉、炸酱面、卤煮、
     豆汁焦圈、北京小吃等经典品类
  3. 每餐推荐1-2家，标注：
     · 人均价格
     · 招牌菜
     · 与行程的衔接便利性
     · 春节营业可能性评估
  4. 备选方案：万一首选关门的替代推荐

输出：
  → 文件：05-food.md
  → 内容：按天+按餐次组织的美食推荐
```

#### A4 - 装备清单 Agent

```
输入：
  - 02-verified-data.md（天气数据）
  - 行程概要（含长城等户外活动）

执行步骤：
  1. 根据2月下旬北京天气制定穿衣方案
  2. 区分场景：城区游览 vs 长城户外
  3. 拍照相关装备（相机、自拍杆、充电宝等）
  4. 证件清单（身份证必带！预约用）
  5. 春节特殊物品
  6. 按"必带/建议带/可选"分级

输出：
  → 文件：06-packing.md
  → 内容：分类装备清单
```

#### A5 - 伴手礼 Agent

```
输入：
  - 03-itinerary.md（确定购物时间窗口）

执行步骤：
  1. 推荐北京经典伴手礼品类
  2. 标注购买地点（尽量融入行程路线）
  3. 价格参考
  4. 春节期间是否能买到

输出：
  → 文件：07-souvenirs.md
  → 内容：伴手礼推荐清单
```

#### QA - 整合校验 Agent

```
输入：
  - 所有文件：02 ~ 07

执行步骤：
  1. 交叉校验 - 检查以下矛盾：
     · 行程时间 vs 景点开放时间
     · 行程地点 vs 交通方案的出发地/目的地
     · 行程安排 vs 餐厅位置的合理性
     · 航班时间 vs 首末日安排的时间余量
     · 长城交通方案 vs 行程中长城日的时间安排
  2. 完整性检查：
     · 所有必去景点是否都排入行程？
     · 每天是否都有餐饮安排？
     · 预约操作日期是否都在当前日期之后？
     · 预算是否有汇总？
  3. 生成总览文档：
     · 一页纸行程总览
     · 关键操作时间线（哪天抢票、哪天确认）
     · 全部[需确认]项的汇总清单

输出：
  → 文件：08-qa-checklist.md（校验报告）
  → 文件：00-overview.md（一页纸总览）
```

### 3.4 执行流水线时序

```
时间线 ──────────────────────────────────────────────────►

Phase 1    [████ A0 数据验证 ████]
           │
Phase 2    └──► [████ A1 行程规划 ████]  [██ A4 装备 ██]
                │                              │
Phase 3         ├──► [██ A2 交通 ██]           │
                ├──► [██ A3 美食 ██]           │
                └──► [██ A5 伴手礼 ██]         │
                     │         │         │     │
Phase 4              └─────────┴─────────┴─────┘
                              │
                     [████ QA 整合 ████]
```

### 3.5 文件产出清单

```
/Users/tingyoo/beijing-trip/v2/
├── 00-overview.md          ← QA Agent 生成，一页纸总览
├── 01-tech-plan.md         ← 本文档
├── 02-verified-data.md     ← A0 数据验证结果
├── 03-itinerary.md         ← A1 五天四晚行程
├── 04-transport.md         ← A2 交通攻略
├── 05-food.md              ← A3 美食攻略
├── 06-packing.md           ← A4 装备清单
├── 07-souvenirs.md         ← A5 伴手礼推荐
└── 08-qa-checklist.md      ← QA 校验报告
```

---

## 4. 风险识别与应对

### 4.1 技术风险

| 风险 | 可能性 | 影响 | 应对方案 |
|------|--------|------|---------|
| 官方网站无法通过 WebFetch 访问（反爬/JS渲染） | **高** | 核心预约规则无法验证 | 1) 尝试移动端页面（m.dpm.org.cn 等）；2) 使用 Fallback 值 + `[需确认]` 标签；3) 提供手动验证步骤指引 |
| Bash 权限不可用 | **已确认** | 无法用 mkdir 创建目录 | Write 工具可自动创建父目录，改用 Write 替代 |
| WebFetch 返回内容过大或格式混乱 | 中 | 无法提取有效信息 | 针对性提取关键段落；对比多个页面交叉验证 |
| 单次会话 token 耗尽 | 中 | Agent 无法全部执行完 | 优先执行 A0+A1（最关键），其余可分批；每个 Agent 完成后立即写入文件 |
| 网站信息过时（仍为2025年数据） | 中 | 春节安排可能与2026年不同 | 标注信息发布日期；2月春节信息通常1月下旬发布，距离出发8天，大部分信息应已发布 |

### 4.2 业务风险

| 风险 | 可能性 | 影响 | 应对方案 |
|------|--------|------|---------|
| 故宫票已约满（春节热门） | **高** | 行程核心景点缺失 | 1) 计算放票日期，提醒用户准时抢票；2) 备选：景山公园俯瞰故宫全景 + 故宫角楼外围拍照；3) 考虑下午场/冷门时段 |
| 长城春节公共交通停运 | 中 | 无法到达长城或成本大增 | 1) 提前确认877路/S2线春节班次；2) 备选：包车（提前预约，约400-600元往返）；3) 备选景点：慕田峪（有景区接驳车） |
| 春节庙会不举办/缩减 | 中 | 弹性行程日缺少活动 | 备选：南锣鼓巷、什刹海冰场（如仍开放）、798艺术区、颐和园等 |
| 餐厅春节歇业 | **高** | 到了门口吃闭门羹 | 1) 每餐推荐2-3个选项；2) 酒店周边大型商场餐饮（万达/华润）春节通常正常营业；3) 提醒提前电话确认 |
| 北京2月极端天气（大风/降雪） | 低 | 户外行程受影响（尤其长城） | 1) 长城日安排在中间日期，前后有调整空间；2) 准备室内备选方案（国博可扩展为全天） |
| 打车困难（春节+景区周边限行） | 中 | 影响出行效率 | 1) 以地铁为主要交通方式；2) 打车提前预约；3) 热门景点打车建议步行至非拥堵路段再叫车 |

### 4.3 信息时效性风险

| 数据类别 | 有效期 | 建议验证时间 | 说明 |
|----------|--------|-------------|------|
| 航班时刻 | 出发前1天 | 2/19 晚复查 | 已验证，但航班可能变更 |
| 景点预约规则 | 放票前确认 | 2/13-2/17（提前7天放票窗口） | 最关键操作窗口 |
| 天气预报 | 3天内较准 | 2/17 后查看 | 出发前3天查看最准确 |
| 餐厅营业状态 | 当天确认最可靠 | 每天出发前 | 电话/大众点评实时查看 |
| 长城交通 | 春节班次表发布后 | 2/15 左右 | 关注北京公交官方公众号 |

---

## 5. 执行前用户确认清单

在启动 Agent 执行流水线之前，请用户确认以下事项：

- [ ] **故宫预约**：是否已了解放票日期？是否需要我计算具体哪天抢票？
  - 出行日 2/20-2/24，若提前7天放票，则 2/13-2/17 期间需抢票
  - **当前日期 2/12，明天 2/13 可能就是抢2/20门票的日子！**
- [ ] **国博预约**：同上，需提前操作
- [ ] **长城预约**：同上
- [ ] **酒店预订**：是否已预订朝阳十里河亚朵？具体哪家门店？
- [ ] **长城选择**：八达岭（最经典，人多）还是慕田峪（人少，体验好）？
- [ ] **预算范围**：是否有每日预算限制？
- [ ] **饮食偏好/忌口**：有无需要避开的食物？
- [ ] **体力情况**：能否接受长城徒步2-3小时？

---

## 6. 下一步行动

确认本技术方案后，请回复以下内容启动执行：

```
请按照 01-tech-plan.md 的方案执行。
用户确认：
- 长城选择：八达岭/慕田峪
- 酒店已订/未订
- 其他补充：...
```

收到确认后，将按 Phase 1 → Phase 4 顺序依次执行各 Agent，所有文件写入 `/Users/tingyoo/beijing-trip/v2/` 目录。

---

*本文档由技术架构 Agent 生成于 2026-02-12*
*可信度标签体系：[已验证] [高置信] [需确认]*
